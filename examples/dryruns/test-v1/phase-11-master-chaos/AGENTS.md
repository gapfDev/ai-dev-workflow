# AGENTS.md
# NexaCore Platform â€” Agent Coordination & Progressive Disclosure

> **Workflow Step:** 3 / 7 (Scaffold & Backlog)  
> **Role:** DevOps + PM Agent  
> **Generated by:** agents-md-generator skill  
> **Date:** 2026-02-21

---

## Repository Overview

**Project:** NexaCore â€” Healthcare SaaS (Urgency Alerts + Admin Dashboard + OCR Intake)  
**Type:** Greenfield, Cloud-Native, Multi-Tenant  
**Team:** 4 Developer Agents (parallel), 1 Manager Agent  
**Timeline:** 3 months  
**Compliance:** HIPAA

---

## ğŸ—ï¸ Architecture at a Glance

```
monorepo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ mobile/          â†’ React Native Doctor App (offline-first, FCM, Twilio)
â”‚   â”œâ”€â”€ web-dashboard/   â†’ Next.js 14 Admin Dashboard
â”‚   â””â”€â”€ web-admissions/  â†’ Next.js 14 Admissions + Intake Form UI
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ alert-service/   â†’ Node.js/NestJS â€” Alert dispatch (FCM + Twilio)
â”‚   â”œâ”€â”€ patient-service/ â†’ Node.js/NestJS â€” Patient CRUD, audit triggers
â”‚   â”œâ”€â”€ ocr-service/     â†’ Python/FastAPI â€” OCR + PAN scrubber + emergency detection
â”‚   â””â”€â”€ audit-service/   â†’ Node.js/NestJS â€” Append-only HIPAA audit log writer
â”œâ”€â”€ shared/
â”‚   â”œâ”€â”€ db/              â†’ Prisma schema, migrations (PostgreSQL)
â”‚   â”œâ”€â”€ auth/            â†’ Auth0 JWT verification middleware
â”‚   â””â”€â”€ types/           â†’ Shared TypeScript types (across apps + services)
â”œâ”€â”€ infra/
â”‚   â”œâ”€â”€ docker/          â†’ Docker Compose for local dev
â”‚   â””â”€â”€ ci/              â†’ GitHub Actions workflows
â””â”€â”€ .agent/
    â”œâ”€â”€ BACKLOG.md       â†’ Source of truth for tickets
    â”œâ”€â”€ SECURITY_BACKLOG.md
    â””â”€â”€ state/
        â””â”€â”€ circuit.json â†’ Circuit breaker state (error counts per service)
```

---

## Agent Assignments

| Agent | Domain | Primary Artifacts |
|-------|--------|-------------------|
| **Agent A** | Alert Service + Doctor Mobile App | `services/alert-service/`, `apps/mobile/` |
| **Agent B** | Patient Service + Admin Dashboard | `services/patient-service/`, `apps/web-dashboard/` |
| **Agent C** | OCR Service + Admissions Web | `services/ocr-service/`, `apps/web-admissions/` |
| **Agent D** | Shared infra: DB, Auth, DevOps, Audit | `shared/`, `services/audit-service/`, `infra/` |

---

## Communication Protocol (agent-communication skill)

All agents post to `.agent/message-board.md` using this format:
```
ğŸ¤– [Agent X] STATUS: <STARTED|BLOCKED|DONE>
Ticket: <TICKET-ID>
Message: <one-line status update>
Timestamp: 2026-02-21T01:48:00Z
```

**Blocked signal format:**
```
ğŸ¤– [Agent X] BLOCKED on <dependency ticket or issue>
Waiting for: <Agent Y> / <Human input>
```

---

## Key Constraints for Agents

1. **PHI handling:** Never log patient data (names, SSN, diagnoses) in console/debug logs
2. **PAN scrubber:** Must run in OCR pipeline BEFORE any data is written to DB
3. **No plaintext PHI:** All PHI fields in PostgreSQL must use `pgcrypto` encryption functions
4. **Audit triggers:** Every patient record read/write generates an audit_log entry
5. **RLS enforcement:** All PostgreSQL queries must respect `app.current_clinic_id` session var
6. **TDD:** Write failing test first; no code written without a test
7. **Circuit breaker:** If a CI step fails 3x â†’ write to `.agent/state/circuit.json` and halt
8. **Strict filenames:** All artifact filenames must exactly match the workflow specification

---

## Dependency Graph (Sprint Order)

```
Agent D (shared/db, auth, infra) â”€â”€â–º unlocks all other agents
      â”‚
      â”œâ”€â”€â–º Agent A (alert-service, mobile app)
      â”‚         â””â”€â”€â–º Agent C (OCR triggers alerts)
      â”‚
      â””â”€â”€â–º Agent B (patient-service, dashboard)
                â””â”€â”€â–º Agent A (dashboard reads alert status)
```

**Start constraint:** Agents A, B, C cannot begin coding until Agent D completes:
- DB migration with RLS policies
- Auth0 JWT middleware shared package
- Docker Compose local dev environment

---

## Escalation Rules

| Scenario | Action |
|----------|--------|
| Blocking dependency > 1 day | Post BLOCKED signal, Manager escalates |
| Security finding (P0/P1 discovered mid-sprint) | Halt ticket, post to message board, notify Manager |
| 3x CI failure | Write circuit.json, halt, signal human |
| PHI found in logs accidentally | IMMEDIATE halt, treat as incident |
| HIPAA BAA not signed before any test data used | Block environment promotion |
